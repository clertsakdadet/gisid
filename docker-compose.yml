version: '2.2'
services:
  acc-service:
    build: ./account-service
    container_name: account_service
    command: sh -c './wait-for acc-db:5432 -- npm start'
    depends_on:
     - acc-db
    links:
     - acc-db
    environment:
     - NODE_ENV=production
     - DB_HOSTNAME=acc-db
     - DB_PORT=5432
     - HOSTNAME=gisid.cdg.co.th
     - SMPT_HOST=mailgateway.cdg.co.th
    extra_hosts:
     - "mailgateway.cdg.co.th:10.254.7.51"
  acc-db:
    build: ./account-db
    container_name: "acc-postgres-db"
    restart: always
    volumes:
      - acc-db-data:/var/lib/postgresql/data
    ports:
      - 5455:5432
  nginx:
    build: ./reverse-proxy
    container_name: "rev_proxy"
    links:
     - acc-service
    ports:
      - 80:80
    extra_hosts:
     - "dev.cdg.co.th:10.0.75.1" ## for Dev local only
volumes:
  acc-db-data: